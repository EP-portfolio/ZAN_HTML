<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Dashboard de suivi de l'artificialisation des sols - Objectif ZAN 2031">
    <title>Dashboard ZAN - Artificialisation des Sols</title>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1 class="sidebar-title">Dashboard ZAN</h1>
                <p class="sidebar-subtitle">Artificialisation des Sols</p>
            </div>
            
            <nav class="sidebar-nav">
                <div class="filter-section">
                    <label class="filter-label">P√©rim√®tre d'√©tude</label>
                    <div class="radio-group">
                        <label class="radio-item">
                            <input type="radio" name="perimetre" value="scot" checked>
                            <span class="radio-custom"></span>
                            <span class="radio-text">SCoT Rives du Rh√¥ne</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="perimetre" value="ccpda">
                            <span class="radio-custom"></span>
                            <span class="radio-text">CC Porte Dr√¥mArd√®che</span>
                        </label>
                    </div>
                </div>
                
                <div class="filter-section">
                    <label class="filter-label">D√©partement</label>
                    <div class="dropdown-container">
                        <button class="dropdown-toggle" id="dropdownDepartements" type="button">
                            <span class="dropdown-text">Tous les d√©partements</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </button>
                        <div class="dropdown-menu" id="menuDepartements">
                            <div class="dropdown-search">
                                <input type="text" placeholder="Rechercher..." class="dropdown-search-input" id="searchDepartements">
                            </div>
                            <div class="dropdown-options" id="optionsDepartements"></div>
                        </div>
                    </div>
                    <div class="filter-hint">S√©lection multiple possible</div>
                </div>
                
                <div class="filter-section">
                    <label class="filter-label">Communes</label>
                    <div class="dropdown-container">
                        <button class="dropdown-toggle" id="dropdownCommunes" type="button">
                            <span class="dropdown-text">Toutes les communes</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </button>
                        <div class="dropdown-menu" id="menuCommunes">
                            <div class="dropdown-search">
                                <input type="text" placeholder="Rechercher..." class="dropdown-search-input" id="searchCommunes">
                            </div>
                            <div class="dropdown-options" id="optionsCommunes"></div>
                        </div>
                    </div>
                    <div class="filter-hint">S√©lection multiple possible</div>
                </div>
                
                <div class="filter-section">
                    <label class="filter-label">Typologie Urbaine</label>
                    <div class="dropdown-container">
                        <button class="dropdown-toggle" id="dropdownTypologies" type="button">
                            <span class="dropdown-text">Toutes les typologies</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </button>
                        <div class="dropdown-menu" id="menuTypologies">
                            <div class="dropdown-search">
                                <input type="text" placeholder="Rechercher..." class="dropdown-search-input" id="searchTypologies">
                            </div>
                            <div class="dropdown-options" id="optionsTypologies"></div>
                        </div>
                    </div>
                    <div class="filter-hint">S√©lection multiple possible</div>
                </div>
                
                <div class="filter-summary" id="filterSummary">
                    <div class="summary-title">S√âLECTION ACTUELLE</div>
                    <div class="summary-item">
                        <span class="summary-label">Communes</span>
                        <span class="summary-value" id="summaryNbCommunes">--</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Habitants</span>
                        <span class="summary-value" id="summaryPop">--</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Artificialis√©</span>
                        <span class="summary-value" id="summaryArtif">-- ha</span>
                    </div>
                </div>
                
                <div class="sidebar-info">
                    <div class="info-item">
                        <span class="info-label">Source</span>
                        <span class="info-value">Observatoire de l'artificialisation</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">P√©riode</span>
                        <span class="info-value">2009-2024</span>
                    </div>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <a href="https://artificialisation.developpement-durable.gouv.fr" target="_blank" class="sidebar-link">
                    Portail national ZAN
                </a>
            </div>
        </aside>
        
        <!-- Mobile Header -->
        <header class="mobile-header">
            <button class="menu-toggle" id="menuToggle" aria-label="Menu">
                <span></span><span></span><span></span>
            </button>
            <h1 class="mobile-title">Dashboard ZAN</h1>
            <div class="mobile-perimetre" id="mobilePerimetre">SCOT</div>
        </header>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Header Principal -->
            <header class="main-header">
                <div class="header-left">
                    <div class="header-border"></div>
                    <div class="header-content">
                        <h1 class="main-title">DASHBOARD DE PILOTAGE ZAN</h1>
                        <p class="main-subtitle">Suivi de l'artificialisation des sols - Objectif Z√©ro Artificialisation Nette</p>
                    </div>
                </div>
                <div class="header-right">
                    <div class="header-meta-card">
                        <div class="meta-label">Derni√®re mise √† jour</div>
                        <div class="meta-value" id="lastUpdate">--</div>
                    </div>
                    <div class="header-meta-card">
                        <div class="meta-label">Date de consultation</div>
                        <div class="meta-value" id="consultDate">--</div>
                    </div>
                </div>
            </header>
            
            <!-- Section Header -->
            <header class="content-header">
                <div class="header-info">
                    <h1 class="page-title">Indicateurs Cl√©s</h1>
                    <p class="page-subtitle" id="perimetreLabel">SCoT des Rives du Rh√¥ne</p>
                </div>
                <div class="header-meta">
                    <span class="meta-item" id="nbCommunes">-- communes</span>
                    <span class="meta-separator">|</span>
                    <span class="meta-item">Donn√©es 2009-2024</span>
                </div>
            </header>
            
            <!-- SECTION 1: KPIs -->
            <section class="kpi-section">
                <div class="kpi-grid">
                    <div class="kpi-card" data-color="blue">
                        <div class="kpi-label">Artificialisation Totale</div>
                        <div class="kpi-value"><span id="kpiArtifTotal">--</span> <span class="kpi-unit">ha</span></div>
                        <div class="kpi-sublabel">Consommation 2009-2024</div>
                    </div>
                    <div class="kpi-card" data-color="green">
                        <div class="kpi-label">Population 2021</div>
                        <div class="kpi-value"><span id="kpiPopulation">--</span></div>
                        <div class="kpi-sublabel">√âvolution: <span id="kpiEvolutionPop">--</span></div>
                    </div>
                    <div class="kpi-card" data-color="purple">
                        <div class="kpi-label">Consommation par habitant</div>
                        <div class="kpi-value"><span id="kpiConsoHab">--</span> <span class="kpi-unit">m¬≤</span></div>
                        <div class="kpi-sublabel">Par habitant ajout√©</div>
                    </div>
                </div>
                
                <div class="kpi-grid kpi-grid-2">
                    <div class="kpi-card" data-color="orange">
                        <div class="kpi-label">Enveloppe ZAN 2031</div>
                        <div class="kpi-value"><span id="kpiEnveloppe">--</span> <span class="kpi-unit">ha</span></div>
                        <div class="kpi-sublabel">Reste: <span id="kpiReste">--</span> ha</div>
                    </div>
                    <div class="kpi-card" id="kpiStatutCard" data-color="green">
                        <div class="kpi-label">Statut Trajectoire</div>
                        <div class="kpi-value"><span id="kpiStatut">--</span></div>
                        <div class="kpi-sublabel"><span id="kpiTaux">--</span>% de l'enveloppe</div>
                    </div>
                </div>
            </section>
            
            <!-- SECTION 2: Trajectoire ZAN -->
            <section class="section-block">
                <div class="section-header">
                    <h2 class="section-title">Trajectoire vers l'objectif ZAN 2031</h2>
                    <p class="section-subtitle">Suivi de la consommation d'espaces par rapport √† l'objectif de r√©duction de 50%</p>
                </div>
                
                <div class="trajectory-grid">
                    <div class="chart-container chart-large" id="chartTrajectory"></div>
                    <div class="trajectory-info">
                        <div class="info-card">
                            <h3>OBJECTIF -50% (LOI CLIMAT)</h3>
                            <table class="info-table">
                                <tr><td>P√©riode de r√©f√©rence</td><td id="infoRefPeriod">2011-2021</td></tr>
                                <tr><td>Consommation de r√©f√©rence</td><td id="infoConsoRef">-- ha</td></tr>
                                <tr><td>Enveloppe 2021-2031</td><td id="infoEnveloppe">-- ha</td></tr>
                                <tr><td>D√©j√† consomm√© (2021-2024)</td><td id="infoConso2124">-- ha</td></tr>
                                <tr class="highlight"><td>Reste disponible</td><td id="infoReste">-- ha</td></tr>
                            </table>
                        </div>
                        <div class="progress-card">
                            <div class="progress-header">
                                <span>Progression</span>
                                <span id="progressValue" class="progress-value">--%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <div class="progress-status" id="progressStatus">--</div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECTION 3: Analyse D√©taill√©e -->
            <section class="charts-section">
                <div class="section-header">
                    <h2 class="section-title">Analyse D√©taill√©e</h2>
                    <p class="section-subtitle">Exploration approfondie des donn√©es d'artificialisation</p>
                </div>
                
                <div class="tabs-nav">
                    <button class="tab-btn active" data-tab="evolution">√âvolution Annuelle</button>
                    <button class="tab-btn" data-tab="repartition">R√©partition</button>
                    <button class="tab-btn" data-tab="top10">Top Communes</button>
                </div>
                
                <div class="tabs-content">
                    <div class="tab-panel active" id="tab-evolution">
                        <div class="chart-container" id="chartEvolution"></div>
                    </div>
                    <div class="tab-panel" id="tab-repartition">
                        <div class="chart-wrapper">
                            <div class="chart-container chart-donut" id="chartRepartition"></div>
                            <div class="chart-legend" id="legendRepartition"></div>
                        </div>
                    </div>
                    <div class="tab-panel" id="tab-top10">
                        <div class="chart-container chart-horizontal" id="chartTop10"></div>
                    </div>
                </div>
            </section>
            
            <!-- SECTION 4: Analyses Avanc√©es -->
            <section class="charts-section">
                <div class="section-header">
                    <h2 class="section-title">Analyses Avanc√©es</h2>
                    <p class="section-subtitle">Indicateurs strat√©giques pour le pilotage territorial</p>
                </div>
                
                <div class="tabs-nav">
                    <button class="tab-btn active" data-tab="typologie2">Analyse par Typologie</button>
                    <button class="tab-btn" data-tab="risques">Risques Communaux</button>
                    <button class="tab-btn" data-tab="densification">√âvolution Densification</button>
                </div>
                
                <div class="tabs-content">
                    <div class="tab-panel active" id="tab-typologie2">
                        <div class="chart-container" id="chartTypologie"></div>
                        <div class="typologie-cards" id="typologieCards"></div>
                    </div>
                    <div class="tab-panel" id="tab-risques">
                        <div class="chart-container chart-horizontal" id="chartRisques"></div>
                    </div>
                    <div class="tab-panel" id="tab-densification">
                        <div class="chart-container" id="chartDensification"></div>
                    </div>
                </div>
            </section>
            
            <!-- SECTION 5: Benchmark -->
            <section class="section-block">
                <div class="section-header">
                    <h2 class="section-title">Benchmark Territorial</h2>
                    <p class="section-subtitle">Comparaison multi-crit√®res entre SCoT et Communaut√© de Communes</p>
                </div>
                <div class="chart-container chart-radar" id="chartBenchmark"></div>
            </section>
            
            <!-- SECTION 6: Tableau des donn√©es -->
            <section class="section-block">
                <div class="section-header">
                    <h2 class="section-title">Donn√©es par Commune</h2>
                    <p class="section-subtitle">Tableau d√©taill√© avec options de recherche et tri</p>
                </div>
                <div class="table-controls">
                    <input type="text" id="searchCommune" class="search-input" placeholder="Rechercher une commune...">
                    <button class="btn-export" id="btnExport">Exporter CSV</button>
                </div>
                <div class="table-container">
                    <table class="data-table" id="communesTable">
                        <thead>
                            <tr>
                                <th data-sort="commune">Commune</th>
                                <th data-sort="departement">D√©partement</th>
                                <th data-sort="population">Population</th>
                                <th data-sort="total_ha">Total (ha)</th>
                                <th data-sort="habitat_ha">Habitat (ha)</th>
                                <th data-sort="activites_ha">Activit√©s (ha)</th>
                            </tr>
                        </thead>
                        <tbody id="communesTableBody"></tbody>
                    </table>
                </div>
            </section>
            
            <!-- Footer -->
            <footer class="content-footer">
                <div class="footer-main">DASHBOARD DE PILOTAGE ZAN</div>
                <div class="footer-sub">Suivi de l'artificialisation des sols - Objectif Z√©ro Artificialisation Nette</div>
                <div class="footer-source">Source : Observatoire de l'artificialisation des sols | Donn√©es : 2009-2024</div>
            </footer>
        </main>
    </div>
    
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <script src="{{ url_for('static', filename='js/charts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
